# =============================================================================
# JELLYFIN COLLECTION - Docker Compose
# =============================================================================
# Configuration principale dans config/config.yml
# Secrets (API keys) dans .env ou variables d'environnement

services:
  jellyfin-collection:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: jellyfin-collection
    restart: unless-stopped
    environment:
      # User/Group IDs (permissions fichiers)
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}

      # =======================================================================
      # SECRETS UNIQUEMENT - La config est dans config/config.yml
      # =======================================================================

      # Jellyfin (requis)
      - JELLYFIN_API_KEY=${JELLYFIN_API_KEY}

      # TMDb (requis)
      - TMDB_API_KEY=${TMDB_API_KEY}

      # Trakt (optionnel - tokens gérés via jfc trakt-auth)
      - TRAKT_CLIENT_ID=${TRAKT_CLIENT_ID:-}
      - TRAKT_CLIENT_SECRET=${TRAKT_CLIENT_SECRET:-}

      # MDBList (optionnel)
      - MDBLIST_API_KEY=${MDBLIST_API_KEY:-}

      # Radarr (optionnel)
      - RADARR_API_KEY=${RADARR_API_KEY:-}

      # Sonarr (optionnel)
      - SONARR_API_KEY=${SONARR_API_KEY:-}

      # OpenAI (optionnel - génération posters IA)
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}

    volumes:
      # config.yml + fichiers YAML collections (lecture seule)
      - ./config:/config:ro
      # Données générées (posters, cache, reports, tokens)
      - ./data:/data
      # Logs applicatifs
      - ./logs:/logs

    networks:
      - media-stack

networks:
  media-stack:
    external: true
