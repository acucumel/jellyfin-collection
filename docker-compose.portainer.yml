# =============================================================================
# JELLYFIN COLLECTION - Docker Compose pour Portainer
# =============================================================================
# Utiliser avec Portainer Stacks + GitHub integration
# Image: ghcr.io/acucumel/jellyfin-collection:latest
#
# Configuration principale dans config/config.yml (monté en volume)
# Variables à configurer dans Portainer: seulement les API keys (secrets)
# =============================================================================

services:
  jellyfin-collection:
    image: ghcr.io/acucumel/jellyfin-collection:latest
    container_name: jellyfin-collection
    restart: unless-stopped

    environment:
      # =========================================================================
      # USER/GROUP IDs (permissions fichiers)
      # =========================================================================
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}

      # =========================================================================
      # SECRETS UNIQUEMENT
      # =========================================================================
      # La configuration (URLs, schedules, etc.) est dans config/config.yml
      # Seuls les secrets (API keys) sont passés en variables d'environnement

      # Jellyfin (requis)
      - JELLYFIN_API_KEY=${JELLYFIN_API_KEY:?JELLYFIN_API_KEY is required}

      # TMDb (requis)
      - TMDB_API_KEY=${TMDB_API_KEY:?TMDB_API_KEY is required}

      # Trakt (optionnel - tokens gérés automatiquement via jfc trakt-auth)
      - TRAKT_CLIENT_ID=${TRAKT_CLIENT_ID:-}
      - TRAKT_CLIENT_SECRET=${TRAKT_CLIENT_SECRET:-}

      # Radarr (optionnel)
      - RADARR_API_KEY=${RADARR_API_KEY:-}

      # Sonarr (optionnel)
      - SONARR_API_KEY=${SONARR_API_KEY:-}

      # OpenAI (optionnel - génération de posters IA)
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}

    volumes:
      # config.yml + fichiers YAML collections (lecture seule)
      - ${JFC_CONFIG_DIR:-./config}:/config:ro
      # Données persistantes (posters, cache, reports, tokens Trakt)
      - ${JFC_DATA_DIR:-./data}:/data
      # Logs applicatifs
      - ${JFC_LOGS_DIR:-./logs}:/logs

    # Réseau (adapter selon votre configuration)
    networks:
      - default
